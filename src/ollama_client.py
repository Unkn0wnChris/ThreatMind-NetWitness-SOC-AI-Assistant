#Imported dependecies                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
import requests

#API configuration 
OLLAMA_API = "http://localhost:8000"

#Connection check
def check_ollama_connection() -> bool:
    try:
        return requests.get(f"{OLLAMA_API}/health", timeout=3).status_code == 200
    except Exception:
        return False

#AI Query function and Response handling 
def ollama_query(prompt: str) -> str:
    """
    Query the Ollama local API.
    Returns AI response string, or raises Exception if it fails.
    """
    try:
        r = requests.post(
            f"{OLLAMA_API}/generate",
            json={"prompt": prompt},
            timeout=120
        )
        r.raise_for_status()
        data = r.json()

        # Handle different possible Ollama response structures
        if "response" in data:
            return data["response"]
        elif "results" in data and len(data["results"]) > 0 and "text" in data["results"][0]:
            return data["results"][0]["text"]
        else:
            raise ValueError("Unexpected Ollama response format")

    except Exception as e:
        # Raise error so calling code can handle/log it
        raise RuntimeError(f"Ollama query failed: {e}")


